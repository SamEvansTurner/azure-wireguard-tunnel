---
# =============================================================================
# Azure WireGuard Tunnel - Ansible Default Variables
#
# These are system defaults for Ansible roles. User-facing configuration
# comes from config.yml which is passed via -e @config.yml.
#
# Roles access config.yml values directly (e.g., domain.name, wireguard.port).
# This file contains internal defaults like paths, packages, and kernel settings.
#
# =============================================================================

# =============================================================================
# SYSTEM DEFAULTS
# =============================================================================

# Timezone
system_timezone: "Australia/Sydney"

# Caddy configuration
caddy_version: "latest"
caddy_user: "caddy"
caddy_group: "caddy"
caddy_config_dir: "/etc/caddy"
caddy_certs_dir: "/etc/caddy/certs"
caddy_log_dir: "/var/log/caddy"
caddy_memory_max: "100M"

# WireGuard defaults
wireguard_interface: "wg0"

# Bandwidth monitor paths
bandwidth_monitor_dir: "/opt/bandwidth-monitor"
bandwidth_monitor_log: "/var/log/bandwidth-monitor.log"
bandwidth_monitor_state: "/var/lib/bandwidth-monitor/state.json"
bandwidth_monitor_interval: "hourly"

# Certificate sync configuration
certsync_user: "certsync"
certsync_incoming_dir: "/home/certsync/incoming"
certsync_certs_dir: "/etc/caddy/certs"
cert_fullchain_file: "fullchain.pem"
cert_privkey_file: "privkey.pem"

# Firewall defaults
ufw_default_incoming: "deny"
ufw_default_outgoing: "allow"

# Fail2ban configuration
fail2ban_bantime: 3600
fail2ban_findtime: 600
fail2ban_maxretry: 3

# Automatic security updates
unattended_upgrades_enabled: true
unattended_upgrades_auto_reboot: false

# Base system packages
base_packages:
  - curl
  - jq
  - htop
  - net-tools
  - python3
  - python3-pip
  - python3-venv

# =============================================================================
# KERNEL HARDENING
# =============================================================================

sysctl_config:
  # IP Forwarding (required for WireGuard)
  net.ipv4.ip_forward: 1
  
  # Ignore ICMP ping
  net.ipv4.icmp_echo_ignore_all: 1
  
  # SYN flood protection
  net.ipv4.tcp_syncookies: 1
  net.ipv4.tcp_max_syn_backlog: 2048
  net.ipv4.tcp_synack_retries: 2
  
  # Disable source packet routing
  net.ipv4.conf.all.accept_source_route: 0
  net.ipv4.conf.default.accept_source_route: 0
  
  # Ignore redirects
  net.ipv4.conf.all.accept_redirects: 0
  net.ipv4.conf.all.send_redirects: 0
  net.ipv4.conf.default.accept_redirects: 0
  net.ipv4.conf.default.send_redirects: 0
  
  # Log suspicious packets
  net.ipv4.conf.all.log_martians: 1
